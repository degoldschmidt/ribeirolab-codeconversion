%% Subplots positions
h_dist=0.03;
v_dist=0.03;
width=(1-(size(ranges,1)+1)*h_dist)/(size(ranges,1));
heights1=[0.2;0.04;0.04;0.09;0.09];
heights2=repmat(0.04,4,1);%[Traj,Etho_H,Etho_Tr]

% Positions=[0.05    0.75    0.2    0.2;...
%     0.05    0.75-0.05-v_dist    0.2    0.05;...1
%     0.05    0.75-2*0.05-2*v_dist    0.2    0.05;...2
%     0.05    0.75-3*0.05-3*v_dist    0.2    0.05;...3
%     0.05    0.75-4*0.05-4*v_dist    0.2    0.05;...4
%     0.05    0.75-5*0.05-5*v_dist    0.2    0.05;...5
%     0.05    0.75-6*0.05-6*v_dist    0.2    0.05];
numplots_per_col=size(heights1,1);
numcols=size(ranges,1);
y1=1-heights(1)-v_dist;
clear Positions
Positions{1}=zeros(numcols*(numplots_per_col+2),4);
rangecounter=1;
for lrange=1:numcols
    Positions{1}((lrange-1)*(numplots_per_col+2)+1:lrange*(numplots_per_col+2)-3,:)=...
        [repmat(h_dist+(lrange-1)*width+(lrange-1)*h_dist,numplots_per_col-1,1),...
        ones(numplots_per_col-1,1)-cumsum(heights1(1:end-1))-(1:numplots_per_col-1)'.*v_dist,...
        repmat(width,numplots_per_col-1,1) heights1(1:end-1)];
    Positions{1}(lrange*(numplots_per_col+2)-3,:)=...
        [(h_dist+(lrange-1)*width+(lrange-1)*h_dist),...
        1-sum(heights1(1:end-1))-(numplots_per_col-1)'.*v_dist,...
        width/2.5 heights1(end-1)];
    Positions{1}(lrange*(numplots_per_col+2)-2,:)=...
        [Positions{1}(lrange*(numplots_per_col+2)-3,1)+(1-1/2.5)*width,...
        1-sum(heights1(1:end-1))-(numplots_per_col-1)'.*v_dist,...
        width/2.5 heights1(end-1)];
    Positions{1}(lrange*(numplots_per_col+2)-1:lrange*(numplots_per_col+2),:)=...
        [[(h_dist+(lrange-1)*width+(lrange-1)*h_dist),...
        1-sum(heights1(1:end))-(numplots_per_col)'.*v_dist,...
        width/2.5 heights1(end-1)];...
        [Positions{1}(lrange*(numplots_per_col+2)-3,1)+(1-1/2.5)*width,...
        1-sum(heights1(1:end))-(numplots_per_col)'.*v_dist,...
        width/2.5 heights1(end-1)]];
    
end
halfrow=ceil(size(heights2,1)/2);
Positions{2}=[[repmat(h_dist,size(heights2,1),1),...
    1-sum(heights1(1:end))-(numplots_per_col)'.*v_dist-cumsum(heights2)-(1:size(heights2,1))'.*v_dist,...
    repmat((1-3*h_dist)/2,size(heights2,1),1), heights2];...
    [repmat(2*h_dist+(1-3*h_dist)/2,size(heights2,1),1),...
    1-sum(heights1(1:end))-(numplots_per_col)'.*v_dist-cumsum(heights2)-(1:size(heights2,1))'.*v_dist,...
    repmat((1-3*h_dist)/2,size(heights2,1),1), heights2]];

if (sum(sum(Positions{1}<0))~=0)||(sum(sum(Positions{2}<0))~=0)
    error('With these parameters, the subplots don''t fit in the figure')
end
close all
figure('Position',[100 50 1400 930],'Color','w')
for lplot=1:size(Positions{1},1)
    subplot('Position',Positions{1}(lplot,:))
end
for lplot=1:size(Positions{2},1)
    subplot('Position',Positions{2}(lplot,:))
end